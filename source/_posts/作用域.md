---
title: JavaScript之作用域
tags: [深入JavaScript, 笔记]
archives_title: Archives
categories: JavaScript
date: 2017-11-09
---
参考:
> 《你不知道的JavaScript part1 第1章》

# 编译原理

## 三个步骤

1. 分词/词法分析:  

    比如`var a = 2`会被分解成
    `var、a、=、2、; `这些都是词法单元  

2. 解析/语法分析:  
这个过程是将词法单元流（数组） 转换成一个由元素逐级嵌套所组成的代表了程序语法
结构的树。 这个树被称为"抽象语法树(`AST`)"
3. 代码生成  
把AST转成可执行代码的过程

# JavaScript编译的不同点

1. 在词法分析跟代码生成有特定步骤优化  
2. 引擎不会有大量时间进行优化  
3. 大部分编译发生在代码执行前几微秒

# JavaScript编译成员

## 引擎、编译器、作用域

### `var a = 2;` 的编译过程  
1. 编译器遇到`var a`时会寻找是否存在同名变量在同一作用域，有就忽略，没有就声明新变量`a`  
2. 引擎访问作用域是否有`a`,有就使用，没有则继续查找  
3. 如果引擎找到就赋`2`的给他，否则就抛出异常  
总结: 赋值会有两个动作，编译器在当前作用域声明变量，然后引擎在该作用域查找改变量，找到则赋值。

# 编译器的查询--LHS、RHS查询

## LHS--赋值操作目标  RHS--复制操作源头

``` javascript
console.log(a); //RHS
a = 2; //LHS
function (a) {
    console.log(a); //2, 进行了a = 2的操作，LHS
}
foo(2); //RHS，找foo的值
```
# 作用域嵌套

``` javascript
function foo(a) {
    console.log( a + b );
}
var b = 2;
foo( 2 ); // 4
```